---
title: Tools
description: Give agents the ability to call functions
---

Tools let agents call your TypeScript functions. Each tool has a name, description, Zod parameter schema, and an execute function.

<Callout type="info">
Stratus handles the full tool loop automatically - Zod validation, parallel execution, error recovery, and 429 retries. No `JSON.parse()`, no dispatch tables, no manual message management. See the [Agentic Tool Use guide](/docs/guides/agentic-tool-use) for the full picture.
</Callout>

## Defining a Tool

```ts title="tools.ts"
import { tool } from "stratus/core";
import { z } from "zod";

const getWeather = tool({
  name: "get_weather",
  description: "Get the current weather for a city",
  parameters: z.object({
    city: z.string().describe("City name"),
    unit: z.enum(["celsius", "fahrenheit"]).optional(),
  }),
  execute: async (_ctx, { city, unit }) => {
    const temp = await fetchWeather(city, unit);
    return `${temp}Â° in ${city}`;
  },
});
```

## Tool Anatomy

| Property | Type | Description |
| --- | --- | --- |
| `name` | `string` | Unique tool name sent to the model |
| `description` | `string` | What the tool does (helps the model decide when to use it) |
| `parameters` | `z.ZodType` | Zod schema for the parameters |
| `execute` | `(context, params, options?) => string` | Function that runs when the model calls the tool |

The `execute` function receives up to three arguments:
1. **`context`** - The context object passed via `run()` options or session config
2. **`params`** - Parsed and validated parameters matching the Zod schema
3. **`options`** - Optional `ToolExecuteOptions` with an `AbortSignal` for cancellation

## Using Context

Tools can access shared context for things like database connections, API clients, or user info:

```ts title="context-tool.ts"
interface AppContext {
  userId: string;
  db: Database;
}

const lookupOrder = tool({
  name: "lookup_order",
  description: "Look up an order by ID",
  parameters: z.object({ orderId: z.string() }),
  execute: async (ctx: AppContext, { orderId }) => {
    const order = await ctx.db.orders.find(orderId, ctx.userId);
    return JSON.stringify(order);
  },
});

const agent = new Agent<AppContext>({
  name: "support",
  model,
  tools: [lookupOrder],
});

await run(agent, "Where is my order #123?", {
  context: { userId: "user_abc", db: myDb },
});
```

## Passing Tools to Agents

```ts
const agent = new Agent({
  name: "assistant",
  model,
  tools: [getWeather, lookupOrder, searchDocs],
});
```

## Passing Tools to Sessions

```ts
const session = createSession({
  model,
  tools: [getWeather, lookupOrder],
});
```

## Tool Call Flow

<Steps>
<Step>

### Model returns a tool call

The model responds with a tool call containing a name and JSON arguments.

</Step>
<Step>

### Arguments are parsed

Stratus parses the arguments JSON and validates them against the Zod schema.

</Step>
<Step>

### Execute function runs

The `execute` function runs with the parsed parameters and context.

</Step>
<Step>

### Result sent back to model

The result string is sent back to the model as a tool message.

</Step>
<Step>

### Model generates final response

The model generates a final response (or calls more tools). This loop continues until the model responds without tool calls, or `toolUseBehavior` causes an early stop.

</Step>
</Steps>

## Abort Signal

When a run is started with an `AbortSignal`, it's passed to each tool's `execute` function via the `options` parameter. Use it to cancel long-running operations:

```ts title="abort-aware-tool.ts"
const searchTool = tool({
  name: "search",
  description: "Search documents",
  parameters: z.object({ query: z.string() }),
  execute: async (_ctx, { query }, options) => { // [!code highlight]
    const res = await fetch(`/api/search?q=${query}`, {
      signal: options?.signal, // [!code highlight]
    });
    return await res.text();
  },
});
```

See [Streaming - Abort Signal](/docs/streaming#abort-signal) for details on passing a signal.

## Error Handling

If a tool's `execute` function throws, the error message is sent back to the model as the tool result. This lets the model recover gracefully:

```ts
execute: async (_ctx, { query }) => {
  const results = await search(query);
  if (results.length === 0) {
    throw new Error("No results found. Try a different query.");
  }
  return JSON.stringify(results);
},
```

## Schema Conversion

<Callout>
Stratus converts Zod schemas to JSON Schema for the Azure API. The conversion adds `additionalProperties: false` to all objects for Azure strict mode compatibility.
</Callout>

Supported Zod types include objects, strings, numbers, booleans, arrays, enums, optionals, nullables, defaults, unions, and descriptions.

